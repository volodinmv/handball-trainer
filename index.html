<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Тренажер для гандбольного вратаря</title>

    <!-- --- НОВЫЕ СТРОКИ ДЛЯ ПРЕВРАЩЕНИЯ В ПРИЛОЖЕНИЕ --- -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Goalie Trainer">
    <link rel="apple-touch-icon" href="icon-512x512.png">
    <link rel="manifest" href="manifest.json">
    <!-- --- КОНЕЦ НОВЫХ СТРОК --- -->

    <style>
        body, html {
            display: flex; justify-content: center; align-items: center;
            height: 100%; width: 100%; margin: 0;
            background-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            overflow: hidden; 
            position: fixed; /* Предотвращает прокрутку на мобильных */
        }
        #game-container {
            width: 100%; height: 100%; position: relative;
            background-color: #e9e9e9; border-radius: 2.5vmin;
        }
        #play-area {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: inherit; overflow: hidden;
            z-index: 1;
        }
        #settings-btn {
            position: absolute; top: 9.5vmin; right: 9.5vmin; z-index: 20;
            background: none; border: none; cursor: pointer; padding: 0.5vmin;
        }
        #settings-btn svg { width: 3.5vmin; height: 3.5vmin; fill: #555; }
        .border { position: absolute; background-color: rgba(128, 128, 128, 0.5); }
        #border-top { top: 0; left: 0; width: 100%; height: 8vmin; }
        #border-right { top: 0; right: 0; width: 8vmin; height: 100%; }
        #border-bottom { bottom: 0; left: 0; width: 100%; height: 8vmin; }
        #border-left { top: 0; left: 0; width: 8vmin; height: 100%; }
        #red-circle, #white-circle {
            width: 8vmin; height: 8vmin; border-radius: 50%;
            position: absolute; display: none; box-sizing: border-box;
        }
        #red-circle { background-color: red; z-index: 5; }
        #white-circle { background-color: white; border: 0.3vmin solid #ccc; z-index: 6; }
        #controls-wrapper {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); z-index: 10;
            text-align: center; width: 80%;
        }
        #settings-panel {
            background: rgba(255, 255, 255, 0.95); padding: 2vmin; border-radius: 1.5vmin;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 1.5vmin;
        }
        .settings-row { display: flex; justify-content: space-between; align-items: center; }
        .settings-row label { font-size: 1.8vmin; white-space: nowrap; margin-right: 1.5vmin;}
        .settings-row input[type="range"] { width: 100%; }
        .settings-row span { font-size: 1.8vmin; font-weight: bold; min-width: 8vmin; text-align: right; }
        #close-settings-btn {
             padding: 1vmin; font-size: 2vmin; cursor: pointer; border-radius: 1vmin;
             border: 0.2vmin solid #aaa; background-color: #fff; margin-top: 1vmin;
        }
        .hidden { display: none !important; }
        #mode-selector { 
            margin-bottom: 2vmin; display: flex; flex-wrap: wrap; justify-content: center;
        }
        .mode-btn {
            padding: 1vmin 1.5vmin; font-size: 1.8vmin; cursor: pointer;
            margin: 0.5vmin; border-radius: 1vmin; border: 0.2vmin solid #ccc;
            background-color: #f0f0f0;
        }
        .mode-btn.active { background-color: #a5d6a7; border-color: #388e3c; }
        #round-display { font-size: 3.5vmin; color: #555; margin-bottom: 2vmin; }
        #timer-display { font-size: 8vmin; font-weight: bold; margin-bottom: 1.5vmin; color: #333; }
        #start-btn, #stop-btn {
            padding: 1.5vmin 3vmin; font-size: 2.5vmin; cursor: pointer;
            margin: 1vmin; border-radius: 1.5vmin; border: 0.2vmin solid #aaa;
            background-color: #fff;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <button id="settings-btn" title="Настройки">
            <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </button>
        <div id="controls-wrapper">
            <div id="settings-panel" class="hidden"><button id="close-settings-btn">Сохранить и закрыть</button></div>
            <div id="main-controls">
                <div id="mode-selector">
                    <button class="mode-btn active">Прямоугольник</button> <button class="mode-btn">Крест</button>
                    <button class="mode-btn">Подъем</button> <button class="mode-btn">Броски</button>
                </div>
                <div id="round-display"></div><div id="timer-display"></div>
                <button id="start-btn">Старт</button><button id="stop-btn">Стоп</button>
            </div>
        </div>
        <div id="play-area">
            <div id="border-top" class="border"></div><div id="border-right" class="border"></div>
            <div id="border-bottom" class="border"></div><div id="border-left" class="border"></div>
            <div id="red-circle"></div><div id="white-circle"></div>
        </div>
    </div>
    <script>
        // JavaScript код остается без изменений
        const gameContainer=document.getElementById("game-container"),startBtn=document.getElementById("start-btn"),stopBtn=document.getElementById("stop-btn"),redCircle=document.getElementById("red-circle"),whiteCircle=document.getElementById("white-circle"),timerDisplay=document.getElementById("timer-display"),roundDisplay=document.getElementById("round-display"),modeButtons=document.querySelectorAll(".mode-btn"),settingsBtn=document.getElementById("settings-btn"),settingsPanel=document.getElementById("settings-panel"),closeSettingsBtn=document.getElementById("close-settings-btn"),mainControls=document.getElementById("main-controls");let SIZE_X,SIZE_Y,CIRCLE_DIAMETER,MAX_X,MAX_Y,MID_X,MID_Y,MAX_PATH_DISTANCE,SPEED;let rectangleSpeedDuration=4e3,crossInterval=3e3,riseInterval=6e3,throwsInterval=3500,workSeconds=120,restSeconds=60,preparationSeconds=5,totalRounds=10;let currentMode="прямоугольник",gameLoopTimeout,timerInterval,preparationInterval,animationTimeouts=[],currentWhitePos=null,currentRound=1,isWorkPhase=!0,secondsLeft=workSeconds;window.addEventListener("resize",stopGame),modeButtons.forEach(e=>{e.addEventListener("click",()=>setMode(e.textContent.toLowerCase(),e))}),startBtn.addEventListener("click",startGame),stopBtn.addEventListener("click",stopGame),settingsBtn.addEventListener("click",openSettings),closeSettingsBtn.addEventListener("click",closeSettings);function createSettingsPanel(){let e=[{id:"work",label:"Раунд",value:workSeconds,min:10,max:300,step:10,unit:"сек"},{id:"rest",label:"Отдых",value:restSeconds,min:10,max:180,step:5,unit:"сек"},{id:"prep",label:"Подготовка",value:preparationSeconds,min:3,max:15,step:1,unit:"сек"},{id:"rounds",label:"Кол-во раундов",value:totalRounds,min:1,max:20,step:1,unit:""},{id:"rect-speed",label:"Прямоуг. (скорость)",value:rectangleSpeedDuration/1e3,min:2,max:8,step:.5,unit:"сек"},{id:"cross-int",label:"Крест (интервал)",value:crossInterval/1e3,min:2,max:8,step:.5,unit:"сек"},{id:"rise-int",label:"Подъем (интервал)",value:riseInterval/1e3,min:3,max:10,step:.5,unit:"сек"},{id:"throws-int",label:"Броски (интервал)",value:throwsInterval/1e3,min:2,max:8,step:.5,unit:"сек"}],t="";e.forEach(e=>{t+=`<div class="settings-row"><label for="${e.id}-slider">${e.label}</label><input type="range" id="${e.id}-slider" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.value}"><span id="${e.id}-value">${e.value} ${e.unit}</span></div>`}),closeSettingsBtn.insertAdjacentHTML("beforebegin",t),e.forEach(e=>{let t=document.getElementById(`${e.id}-slider`),n=document.getElementById(`${e.id}-value`);t.addEventListener("input",()=>{n.textContent=`${t.value} ${e.unit}`})})}createSettingsPanel();function openSettings(){stopGame(),mainControls.classList.add("hidden"),settingsPanel.classList.remove("hidden"),settingsBtn.classList.add("hidden")}function closeSettings(){workSeconds=parseInt(document.getElementById("work-slider").value),restSeconds=parseInt(document.getElementById("rest-slider").value),preparationSeconds=parseInt(document.getElementById("prep-slider").value),totalRounds=parseInt(document.getElementById("rounds-slider").value),rectangleSpeedDuration=1e3*parseFloat(document.getElementById("rect-speed-slider").value),crossInterval=1e3*parseFloat(document.getElementById("cross-int-slider").value),riseInterval=1e3*parseFloat(document.getElementById("rise-int-slider").value),throwsInterval=1e3*parseFloat(document.getElementById("throws-int-slider").value),mainControls.classList.remove("hidden"),settingsPanel.classList.add("hidden"),settingsBtn.classList.remove("hidden"),initializeDisplays()}function setMode(e,t){currentMode!==e&&(currentMode=e,modeButtons.forEach(e=>e.classList.remove("active")),t.classList.add("active"),startBtn.disabled||stopGame())}function startGame(){stopGame(),redCircle.style.display="block",updateDimensions(),redCircle.style.display="none",startBtn.disabled=!0,stopBtn.disabled=!1,startPreparationCountdown()}function stopGame(){clearInterval(preparationInterval),clearTimeout(gameLoopTimeout),animationTimeouts.forEach(clearTimeout),animationTimeouts=[],clearInterval(timerInterval),redCircle.style.display="none",whiteCircle.style.display="none",whiteCircle.style.transition="none",currentWhitePos=null,currentRound=1,isWorkPhase=!0,secondsLeft=workSeconds,initializeDisplays(),startBtn.disabled=!1,stopBtn.disabled=!0,settingsBtn.classList.remove("hidden")}function startPreparationCountdown(){let e=preparationSeconds;timerDisplay.style.color="#337ab7",roundDisplay.textContent=`Раунд ${currentRound} / ${totalRounds}`,timerDisplay.textContent=`Старт через: ${e}`,preparationInterval=setInterval(()=>{e--,timerDisplay.textContent=`Старт через: ${e}`,e<=0&&(clearInterval(preparationInterval),runActiveMode(),startTimer())},1e3)}function runActiveMode(){whiteCircle.style.display="none";switch(currentMode){case"прямоугольник":rectangleStep();break;case"крест":crossStep();break;case"подъем":riseStep();break;case"броски":throwsStep()}}function rectangleStep(){if(!isWorkPhase)return;null===currentWhitePos&&(currentWhitePos=getRandomSpawnPoint(),placeCircle(whiteCircle,currentWhitePos));let e;do{e=getRandomSpawnPoint()}while(e.name===currentWhitePos.name);placeCircle(redCircle,e);let t=animateWhiteCircleAlongPath(currentWhitePos,e);currentWhitePos=e,gameLoopTimeout=setTimeout(()=>{isWorkPhase&&rectangleStep()},t)}function throwsStep(){if(!isWorkPhase)return;placeCircle(redCircle,getRandomSpawnPoint());let e=setTimeout(()=>{redCircle.style.display="none"},1500);animationTimeouts.push(e),gameLoopTimeout=setTimeout(throwsStep,throwsInterval)}function crossStep(){if(!isWorkPhase)return;placeCircle(redCircle,getRandomSpawnPoint());let e=setTimeout(()=>{redCircle.style.display="none"},1500);animationTimeouts.push(e),gameLoopTimeout=setTimeout(crossStep,crossInterval)}function riseStep(){if(!isWorkPhase)return;placeCircle(redCircle,getRandomSpawnPoint());let e=riseInterval-1e3,t=setTimeout(()=>{redCircle.style.display="none"},e>500?e:500);animationTimeouts.push(t),gameLoopTimeout=setTimeout(riseStep,riseInterval)}function startTimer(){secondsLeft=workSeconds,updateTimerDisplay(),timerInterval=setInterval(()=>{secondsLeft--,updateTimerDisplay(),secondsLeft<0&&(isWorkPhase?(isWorkPhase=!1,secondsLeft=restSeconds,redCircle.style.display="none",clearTimeout(gameLoopTimeout),currentRound>=totalRounds&&(stopGame(),roundDisplay.textContent="Тренировка окончена!")):(isWorkPhase=!0,currentRound++,clearInterval(timerInterval),startPreparationCountdown()))},1e3)}function updateDimensions(){SIZE_X=gameContainer.offsetWidth,SIZE_Y=gameContainer.offsetHeight,CIRCLE_DIAMETER=redCircle.offsetWidth,MAX_X=SIZE_X-CIRCLE_DIAMETER,MAX_Y=SIZE_Y-CIRCLE_DIAMETER,MID_X=SIZE_X/2-CIRCLE_DIAMETER/2,MID_Y=SIZE_Y/2-CIRCLE_DIAMETER/2,MAX_PATH_DISTANCE=MAX_X+MAX_Y,SPEED=MAX_PATH_DISTANCE/rectangleSpeedDuration}function getPointsForCurrentMode(){let e=[{name:"topLeft",top:0,left:0,side:3},{name:"topRight",top:0,left:MAX_X,side:0},{name:"bottomRight",top:MAX_Y,left:MAX_X,side:1},{name:"bottomLeft",top:MAX_Y,left:0,side:2},{name:"midTop",top:0,left:MID_X,side:0},{name:"midRight",top:MID_Y,left:MAX_X,side:1},{name:"midBottom",top:MAX_Y,left:MID_X,side:2},{name:"midLeft",top:MID_Y,left:0,side:3}];switch(currentMode){case"крест":return e.filter(e=>["midTop","midBottom","midLeft","midRight"].includes(e.name));case"подъем":return e.filter(e=>["topLeft","midTop","topRight"].includes(e.name));default:return e}}function getRandomSpawnPoint(){let e=getPointsForCurrentMode();return e[Math.floor(Math.random()*e.length)]}function placeCircle(e,t){e.style.transition="none",e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.display="block"}function animateWhiteCircleAlongPath(e,t){let n=calculateShortestPath(e,t),o=n.distance,i=o/SPEED;if(0===o)return 0;let a=0;for(let l=0;l<n.path.length;l++){let r=n.path[l],s=0===l?e:n.path[l-1],d=Math.abs(s.top-r.top)+Math.abs(s.left-r.left),c=d/o*i,u=setTimeout(((e,t)=>()=>{whiteCircle.style.transition=`top ${t}ms linear, left ${t}ms linear`,whiteCircle.style.top=`${e.top}px`,whiteCircle.style.left=`${e.left}px`})(r,c),a);animationTimeouts.push(u),a+=c}return i}function calculateShortestPath(e,t){if(e.top===t.top&&e.left===t.left)return{path:[],distance:0};let n=[{top:0,left:0},{top:0,left:MAX_X},{top:MAX_Y,left:MAX_X},{top:MAX_Y,left:0}],o=function(e,t){return Math.abs(e.top-t.top)+Math.abs(e.left-t.left)};if(e.side===t.side)return{path:[t],distance:o(e,t)};let i=0,a=[],l={...e},r=e.side;for(;;){let s=(r+1)%4,d=n[s];if(i+=o(l,d),a.push(d),l=d,r=s,r===t.side){i+=o(l,t),a.push(t);break}}let s=0,d=[],c={...e},u=e.side;for(;;){let p=n[u];if(s+=o(c,p),d.push(p),c=p,u=(u+3)%4,u===t.side){s+=o(c,t),d.push(t);break}}return i<=s?{path:a,distance:i}:{path:d,distance:s}}function initializeDisplays(){let e=Math.floor(workSeconds/60),t=workSeconds%60;timerDisplay.textContent=`${e}:${String(t).padStart(2,"0")}`,timerDisplay.style.color="#333",roundDisplay.textContent=`Раунд 1 / ${totalRounds}`}function updateTimerDisplay(){let e=Math.floor(secondsLeft/60),t=secondsLeft%60;timerDisplay.textContent=`${e}:${String(t).padStart(2,"0")}`,roundDisplay.textContent=isWorkPhase?`Раунд ${currentRound} / ${totalRounds}`:"Отдых",timerDisplay.style.color=isWorkPhase?"red":"green"}initializeDisplays(),stopBtn.disabled=!0;
    </script>
</body>
</html>
